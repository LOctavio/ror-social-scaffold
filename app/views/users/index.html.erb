<section class="users-section">
  <ul class="users-list">
    <% @users.each do |user| %>
      <li>
        <span class="profile-link">
          <%= link_to user.name,  user_path(user), class: 'profile-link' %>
        </span>

        <% if user.id != current_user.id && !current_user.friend?(user)%>
          <% pending_friend = current_user.pending_friends.find { |friend| friend.id == user.id } %>
          <% friend_request = current_user.friend_requests.find { |friend| user.id == friend.id } %>
          <% if friend_request %>
            <%= button_to 'Accept', current_user.confirm_friend(user) %>
          <% else %>
            <% if pending_friend %> 
              <%= button_to 'Pending', user_path(user), disabled: true %> 
            <% else %> 
              <%= button_to "Add friend", friendships_path(friend_id: user.id, user_id: current_user), method: 'post' %> 
            <% end %>
          
          <% end %>
        <% end %>
        
      </li>
    <% end %>
  </ul>
</section>
