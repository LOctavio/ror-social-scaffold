<section class="users-section">
  <ul class="users-list">
    <% @users.each do |user| %>
      <li>
        <span class="profile-link">
          <%= link_to user.name,  user_path(user), class: 'profile-link' %>
        </span>

        <% if user != current_user && !current_user.friend?(user) %>
          <% pending_friend = current_user.pending_friends.find { |friend| friend.id == user.id } %>
          <% friend_request = current_user.friend_requests.find { |friend| friend.id == user.id } %>
          
          <% if friend_request %>
            <% @friend_requests.each do |fr| %>
              <%= button_to  "Confirm", update_friendship_path({friendship: fr, status: true}), method: 'patch' %>
              <%= button_to  "Delete request" %>
            <% end %>
          <% elsif pending_friend%>
              <%= button_to 'Pending', user_path(user), disabled: true %>
          <% else %> 
              <%= button_to "Add friend", send_friendship_request_path(user_id: user.id) %> 
          <% end %>
        <% end %>
        
      </li>
    <% end %>
  </ul>
</section>
